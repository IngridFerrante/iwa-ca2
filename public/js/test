
//saving the concert that was submitted via API
function submitConcert() {
    var jsonToAdd = getFields();
    let obj = JSON.parse(jsonToAdd)
    console.log(jsonToAdd)

    
    if(jsonToAdd == null){
        alert("Fill all the fields");
        return;
    }
    
    let newId = '';
    
    fetch(apiURL,{
        method: 'post',
        headers: {
            'Content-Type': 'application/json'
          },
        body: JSON.stringify(obj)
    }).then(response => response.json()) 
    .then(json => {
        console.log(json)
        newId =json._id ;
    })
    .catch(err => console.log(err));
    
    
    getConcertNames(); 
    $("#form-concerts").empty();
    concertSelected='';
    
}

// take all the information and parses it to a JSON Format
function getFields(){

    var location = document.getElementById("clocation").value;
    var concertName = document.getElementById("cname").value.trim();

    
    var strJSON = '{'+
        
        '"Concert":"' + concertName ;


    if(strJSON.endsWith(',')){
        strJSON = strJSON.slice(0,strJSON.length -1);
    }

    strJSON+='],'+
        '"location":"'+location+'"}';


        //null if there is any field empty
    if(concertName == '' ||location == ''){  
        return null;
    }
    else{
        console.log(strJSON);
        return strJSON.replace(/\n/g, "\\\\n").replace(/\r/g, "\\\\r").replace(/\t/g, "\\\\t");
        
    }

}

// show my concerts in the main page
function showConcert(concertIds){
    
    let url = apiURL + concertIds;
    
    fetch(url)
    .then(function (response){
        return response.json();
    })
    .then(function(concert){
    
        let strHtml = "<h1>"+concert.concertName+"</h1>"

        strHtml+="<h2>Location: </h2>"+
            "<p>"+ concert.location.replace(/\\n/g, "<br />"); +"</p>"

        $("#concert-form").append(strHtml);

    }).catch(function (err){
        console.log(err);
    }); 

};


//opens the recipe clicked on the left menu
function checkConcert(concertIds){
    $("#form-concerts").empty();
    showConcert(concertIds);
    concertSelected = concertIds;
};



// search for concerts in the API and put it on "my-concerts"
function getConcertNames(){
    
    fetch(apiURL)
    .then(function (response){
        return response.json();
    })
    .then(function(data){
        for (var i = 0; i< data.length ; i++ ){
            var id = data[i]._id;
            if(!concertIds.includes(id)){
            document.getElementById("my-concerts").innerHTML +=
            "<li id='artists"+id+"' onclick= \"checkConcert('"+id+"')\">" + data[i].concertName+"</li>"
            concertIds.push(id);
            }
        
        }
    }).catch(function (err){
        console.log(err);
    }); 
    console.log(concertIds);

};

//when document ready get concert names that are there.
$(document).ready(function(){
    getConcertNames();
});


